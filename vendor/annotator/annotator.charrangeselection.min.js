/*
** Annotator 1.2.6-dev-7acde3d
** https://github.com/okfn/annotator/
**
** Copyright 2012 Aron Carroll, Rufus Pollock, and Nick Stenning.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2013-10-30 05:00:32Z
*/((function(){var a,b,c,d,e,f,g,h,i=Object.prototype.hasOwnProperty,j=function(a,b){function d(){this.constructor=a}for(var c in b)i.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Annotator.Plugin.CharRangeSelection=function(c){function d(){d.__super__.constructor.apply(this,arguments)}return j(d,c),d.prototype.events={annotationCreated:"annotationCreated",annotationsLoaded:"annotationsLoaded"},d.prototype.pluginInit=function(){!!Annotator.supported()},d.prototype.annotationCreated=function(a){var c,d,f,g,h,i,j,k;return f=50,a.ranges==null?a:(d=e(this.element.text()),i=a.ranges[0].normalize(this.annotator.wrapper[0]),c=new b,g=c.offsetsFromNormalizedRange(this.annotator.wrapper[0],i),j=e(a.quote),h=g.start-f<0?0:g.start-f,k=g.end+f>d.length?d.length:g.end+f,a.prefix=d.slice(h,g.start),a.suffix=d.slice(g.end,k),a.startOffset=g.start,a.endOffset=g.end,a)},d.prototype.annotationsLoaded=function(b){var c,d,e,f,g,h,i;for(e=0,g=b.length;e<g;e++){c=b[e];if(c.startOffset!=null)if(c.ranges==null||c.ranges.length===0)this._loadAnnotation(c);else if(c.originalQuote!==c.text){if(c.highlights!=null){i=c.highlights;for(f=0,h=i.length;f<h;f++)d=i[f],a(d).replaceWith(d.childNodes)}this._loadAnnotation(c)}}return b},d.prototype._loadAnnotation=function(a){var c,d,e,f,g;d=this.element[0],c=3,e={start:a.startOffset,end:a.endOffset},f=(new b).rangeFromCharOffsets(d,e),g=f.toString().trim();if(a.originalQuote!=null&&a.originalQuote!==g){console.log("PANIC: annotation is attached incorrectly. Should be: '"+a.originalQuote+"'. But is: '"+g+"'",{range:f,annotation:a});return}return a.ranges=[],a.ranges.push(f),this.annotator.setupAnnotation(a)},d}(Annotator.Plugin),b=function(){function f(){}var a,b;return a="annotator_ignore",b=3,f.prototype.offsetsOfString=function(a,b){var d,e,f;return f={},e=a.textContent.indexOf(b),d=a.textContent.lastIndexOf(b),e!==d&&console.log("PANIC - multiple positions of text found"),f.start=c(a.textContent,e),f.end=c(a.textContent,e+b.length),f},f.prototype.offsetsFromDomRange=function(a,b){return b=(new Annotator.Range.BrowserRange(b)).normalize(a),this.offsetsFromNormalizedRange(a,b)},f.prototype.offsetsFromNormalizedRange=function(c,d){var f,g,i;return i={},f=0,g=function(c){if(typeof c.hasAttribute=="function"?c.hasAttribute(a):void 0)return!1;if(c.nodeType===b)return c===d.start&&(i.start=f),c===d.end&&(i.end=f+e(c.textContent).length),f+=e(c.textContent).length},h(c,g),i},f.prototype.rangeFromCharOffsets=function(c,f){var g,i,j,k,l;return l=f.start,i=f.end,g=0,k=document.createRange(),j=function(c){var f,h;if(typeof c.hasAttribute=="function"?c.hasAttribute(a):void 0)return!1;if(k.endContainer!==document)return!1;if(c.nodeType===b)return f=e(c.textContent).length,f+g>l&&g<=l&&(h=d(c.textContent,l-g),k.setStart(c,h)),f+g>=i&&g<=i&&(h=d(c.textContent,i-g),k.setEnd(c,h)),g+=f},h(c,j),k},f}(),d=function(a,b){var c,d,e,g,h;e=0,d=0;if(b===e)return e;for(g=0,h=a.length;g<h;g++){c=a[g],e++,f.test(c)||d++;if(b===d)return e}return e},c=function(a,b){var c,d,e,g,h;d=0,e=0;if(b===e)return d;for(g=0,h=a.length;g<h;g++){c=a[g],e++,f.test(c)||d++;if(b===e)return d}return d},e=function(a){return a.replace(g,"")},f=/[\n\s]/,g=/[\n\s]/g,h=function(a,b){var c,d;c=b(a);if(c===!1)return;a=a.firstChild,d=[];while(a)h(a,b),d.push(a=a.nextSibling);return d},a=Annotator.$})).call(this);