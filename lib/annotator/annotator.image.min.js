/*
** Annotator 1.2.6-dev-2e3fa87
** https://github.com/okfn/annotator/
**
** Copyright 2012 Aron Carroll, Rufus Pollock, and Nick Stenning.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2013-04-02 04:58:27Z
*/((function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};Annotator.Plugin.Image=function(b){function d(){this.updateImageHighlights=a(this.updateImageHighlights,this),this._onSelectStart=a(this._onSelectStart,this),this._onSelectEnd=a(this._onSelectEnd,this),this.deselect=a(this.deselect,this),this._onWindowResized=a(this._onWindowResized,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.currentImage=null,d.prototype.relativeSelection=null,d.prototype.pluginInit=function(){return this.element.find("img").imgAreaSelect({handles:!0,onSelectEnd:this._onSelectEnd,onSelectStart:this._onSelectStart}),jQuery(document).bind({mousedown:this.deselect}),jQuery(window).resize(this._onWindowResized),jQuery(element).resize(this._onWindowResized),this.annotator.addAnnotationPlugin(this),this._setupListeners()},d.prototype._onWindowResized=function(){var a;return a=this,jQuery(document).find("span.annotator-hl").map(function(){var b;b=jQuery(this).data("annotation");if(b)return a.updateMarkerPosition(b)})},d.prototype.deselect=function(){if(this.currentImage)return jQuery(this.currentImage).imgAreaSelect({instance:!0}).cancelSelection()},d.prototype._onSelectEnd=function(a,b){var c,d,e;if(b.width===0||b.height===0){this.annotator.adder.hide();return}return this.currentImage=a,d=jQuery(a).position(),c={top:d.top+b.y1-5,left:d.left+b.x2+5},e={x1:b.x1/a.width,x2:b.x2/a.width,y1:b.y1/a.height,y2:b.y2/a.height,width:b.width/a.width,height:b.height/a.height},e.image=a,this.annotator.adder.data("relativeSelection",e),this.annotator.adder.css(c).show()},d.prototype._onSelectStart=function(a,b){var c;return(c=this.adder)!=null&&c.removeData("selection"),this.annotator.adder.hide()},d.prototype._setupListeners=function(){var a,b,c,d;b=["annotationsLoaded","annotationCreated","annotationUpdated","annotationDeleted"];for(c=0,d=b.length;c<d;c++)a=b[c],this.annotator.subscribe(a,this.updateImageHighlights);return this},d.prototype.handlesAnnotation=function(a){return a.relativeSelection!=null?!0:!1},d.prototype.setupAnnotation=function(a){return this.deselect(),this.createMarker(a),a.removeMarkers=function(){return this.marker.remove()},a},d.prototype.borderWidth=2,d.prototype.borderColour="red",d.prototype.createMarker=function(a){var b;return b=jQuery("<span>").appendTo(this.element),a.marker=b,b.data("annotation",a),this.updateMarkerPosition(a)},d.prototype.updateMarkerPosition=function(a){var b,c,d,e;if(!a.relativeSelection)return;return b=a.relativeSelection.image,d=a.marker,c=jQuery(b).offset(),e=a.relativeSelection,d.css({position:"absolute",border:this.borderWidth+"px solid "+this.borderColour,zIndex:1e3}).offset({left:c.left+e.x1*b.width+this.borderWidth,top:c.top+e.y1*b.height+this.borderWidth}),d.width(e.width*b.width-this.borderWidth*2),d.height(e.height*b.height-this.borderWidth*2),d.addClass("annotator-hl annotator-image")},d.prototype.updateImageHighlights=function(){return this},d}(Annotator.Plugin),Annotator.Annotation=function(){function a(){}return a.prototype.createMarker=function(){},a}(),Annotator.ImageAnnotation=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.hideMarker=function(){var a;return(a=this.marker)!=null?a.hide():void 0},b}(Annotator.Annotation)})).call(this);