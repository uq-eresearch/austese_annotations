/*
** Annotator 1.2.6-dev-30b6543
** https://github.com/okfn/annotator/
**
** Copyright 2012 Aron Carroll, Rufus Pollock, and Nick Stenning.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2013-05-21 00:13:16Z
*/((function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Annotator.Plugin.Reply=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.events={annotationViewerShown:"annotationViewerShown",".annotator-reply click":"onReplyClick",".annotator-replies-count click":"showReplies",".annotator-link click":"viewAnnotation"},c.prototype.pluginInit=function(){if(!Annotator.supported())return;return this.annotator.viewer.addField({load:this.updateViewerReplies,annoPlugin:this}),this.annotator.editor.addField({load:this.updateEditorInReplyTo,annoPlugin:this})},c.prototype.updateEditorInReplyTo=function(a,b){var c;return b.inReplyTo?(c=Annotator.$.trim(b.inReplyTo.text).substring(0,68).trim(this)+(b.inReplyTo.text.length>68?"...":""),Annotator.$(a).attr("readonly",!0).addClass("muted").css("padding","2px").html("In reply to '<i>"+c+"</i>'"+(b.inReplyTo.creator?" by "+b.inReplyTo.creator:""))):Annotator.$(a).remove()},c.prototype.updateViewerReplies=function(a,b){var c,d,e,f=this;c=function(c){var f,g,h;return b.replies||(b.replies=e.mapAnnotations(c)),f=b.replies,f.sort(function(a,b){return a.created>b.created}),f.length>0?(h=Annotator.$("<span class='annotator-replies-count'>"+f.length+" Repl"+(f.length===1?"y":"ies")+"</span>"),g=Annotator.$("<div class='annotator-replies-content' style='display:none;padding-top:0.5em'></div>"),a.html(h),a.append(g),f.forEach(function(a){return g.append("<p style='border:1px solid #dedede; padding:3px'><span style='color:#3c3c3c'>"+a.text+"</span><br/>"+(d?"<span style='font-size:smaller;'>"+d.formatProvInfo(a.creator,a.created)+"</span>":"")+"</p>")})):a.remove()},e=this.annoPlugin.annotator.plugins.LoreStore,d=this.annoPlugin.annotator.plugins.Prov;if(!e){a.remove();return}return a=Annotator.$(a),b.replies?c(b.replies):e._apiRequest("search",{annotates:b.id},c)},c.prototype.annotationViewerShown=function(a,b){return Annotator.$(a.element).find(".annotator-controls").append('<button class="annotator-link" title="View">View</button>').append('<button style="background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAKCAYAAABv7tTEAAAEJGlDQ1BJQ0MgUHJvZmlsZQAAOBGFVd9v21QUPolvUqQWPyBYR4eKxa9VU1u5GxqtxgZJk6XtShal6dgqJOQ6N4mpGwfb6baqT3uBNwb8AUDZAw9IPCENBmJ72fbAtElThyqqSUh76MQPISbtBVXhu3ZiJ1PEXPX6yznfOec7517bRD1fabWaGVWIlquunc8klZOnFpSeTYrSs9RLA9Sr6U4tkcvNEi7BFffO6+EdigjL7ZHu/k72I796i9zRiSJPwG4VHX0Z+AxRzNRrtksUvwf7+Gm3BtzzHPDTNgQCqwKXfZwSeNHHJz1OIT8JjtAq6xWtCLwGPLzYZi+3YV8DGMiT4VVuG7oiZpGzrZJhcs/hL49xtzH/Dy6bdfTsXYNY+5yluWO4D4neK/ZUvok/17X0HPBLsF+vuUlhfwX4j/rSfAJ4H1H0qZJ9dN7nR19frRTeBt4Fe9FwpwtN+2p1MXscGLHR9SXrmMgjONd1ZxKzpBeA71b4tNhj6JGoyFNp4GHgwUp9qplfmnFW5oTdy7NamcwCI49kv6fN5IAHgD+0rbyoBc3SOjczohbyS1drbq6pQdqumllRC/0ymTtej8gpbbuVwpQfyw66dqEZyxZKxtHpJn+tZnpnEdrYBbueF9qQn93S7HQGGHnYP7w6L+YGHNtd1FJitqPAR+hERCNOFi1i1alKO6RQnjKUxL1GNjwlMsiEhcPLYTEiT9ISbN15OY/jx4SMshe9LaJRpTvHr3C/ybFYP1PZAfwfYrPsMBtnE6SwN9ib7AhLwTrBDgUKcm06FSrTfSj187xPdVQWOk5Q8vxAfSiIUc7Z7xr6zY/+hpqwSyv0I0/QMTRb7RMgBxNodTfSPqdraz/sDjzKBrv4zu2+a2t0/HHzjd2Lbcc2sG7GtsL42K+xLfxtUgI7YHqKlqHK8HbCCXgjHT1cAdMlDetv4FnQ2lLasaOl6vmB0CMmwT/IPszSueHQqv6i/qluqF+oF9TfO2qEGTumJH0qfSv9KH0nfS/9TIp0Wboi/SRdlb6RLgU5u++9nyXYe69fYRPdil1o1WufNSdTTsp75BfllPy8/LI8G7AUuV8ek6fkvfDsCfbNDP0dvRh0CrNqTbV7LfEEGDQPJQadBtfGVMWEq3QWWdufk6ZSNsjG2PQjp3ZcnOWWing6noonSInvi0/Ex+IzAreevPhe+CawpgP1/pMTMDo64G0sTCXIM+KdOnFWRfQKdJvQzV1+Bt8OokmrdtY2yhVX2a+qrykJfMq4Ml3VR4cVzTQVz+UoNne4vcKLoyS+gyKO6EHe+75Fdt0Mbe5bRIf/wjvrVmhbqBN97RD1vxrahvBOfOYzoosH9bq94uejSOQGkVM6sN/7HelL4t10t9F4gPdVzydEOx83Gv+uNxo7XyL/FtFl8z9ZAHF4bBsrEwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAN1JREFUKBV9kTEOAUEUhmfYQtQu4BAKhWjoNOIQLiBxCNFIJDqNUusItDQ6Z1DoROz4/tk3m80WJvny3rz//W9nZ1wIwQlWQ1jeJ59a3kw9KarRee8l5IJ8RukCPWmsjFoDfLFlMrkMX0VYIxxNjAPR3jYwoBdGCurpwhm0yS0+iVfYw0h91huNE4ovkOEDyaR9lV0yxiMg1pea62vO6bax+Od4dxpOoEt5QPrqkNzFK1WEDSRxYQNb1Dowhhsc0s+Vb0FRVy7jykxVrU19GU0mVh93gFg+Lrm0zPqyH71Zj00AB94xAAAAAElFTkSuQmCC);" title="Reply" class="annotator-reply">Reply</button>')},c.prototype.onReplyClick=function(a){var b,c,d,e,f,g,h,i=this;return e=Annotator.$(a.target).parents(".annotator-annotation"),b=e.data("annotation"),delete b.replies,f=Annotator.$(this.annotator.viewer.element).position(),g=this.setupReply(b),h=function(){return d(),i.publish("annotationCreated",[g])},c=function(){return d()},d=function(){return i.unsubscribe("annotationEditorHidden",c),i.unsubscribe("annotationEditorSubmit",h)},this.subscribe("annotationEditorHidden",c),this.subscribe("annotationEditorSubmit",h),this.annotator.showEditor(g,f)},c.prototype.showReplies=function(a){var b,c;return c=Annotator.$(a.target).parents(".annotator-annotation"),b=c.data("annotation"),c.find(".annotator-replies-content").toggle()},c.prototype.viewAnnotation=function(a){var b,c;return c=Annotator.$(a.target).parents(".annotator-annotation"),b=c.data("annotation"),window.open("/annotations/search/id?uri="+encodeURIComponent(b.id))},c.prototype.setupReply=function(a){var b;return b={uri:a.id,text:"",inReplyTo:a,highlights:[],motivation:"oa:replying"},b},c}(Annotator.Plugin)})).call(this);